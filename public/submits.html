<!doctype html>
<html lang="en">
  <head>
    <title>FAST Learning and Development Center</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="/images/LOGO.png" rel="icon" style="border-radius:10%">
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700,900|Rubik:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">

    <link rel="stylesheet" href="sneat/assets/vendor/fonts/boxicons.css" />
    <link rel="stylesheet" href="sneat/assets/vendor/fonts/fontawesome.css" />
    <link rel="stylesheet" href="sneat/assets/vendor/fonts/flag-icons.css" />

    <link rel="stylesheet" href="fonts/ionicons/css/ionicons.min.css">
    <link rel="stylesheet" href="fonts/fontawesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <!-- Theme Style -->
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/tabulator-tables@5.1.0/dist/css/tabulator.min.css" rel="stylesheet">    <link id="themeStylesheet" href="https://unpkg.com/tabulator-tables@5.6.0/dist/css/tabulator_bootstrap5.min.css" rel="stylesheet"/>
    <script src="https://unpkg.com/tabulator-tables@5.6.0/dist/js/tabulator.min.js"></script>

  </head>
  <body>

    <div id="header"></div>
    <!-- END header -->

    <section class="site-section">
      <div class="container">
        <h2 class="mb-4 mt-4">Submitted Reservations</h2>
        <div id="reserve-table" style="font-size: 14;overflow-x: auto;overflow-y: auto;border: 1px solid #ccc;max-height: 400px; padding: 4px;"></div>
    </section>

    <div id="footer"></div>
    <!-- END footer -->

    <script>
        let USERID = null; // Define USERID in the global scope to be accessible in Tabulator configuration
    
        // Fetch API to validate the cookie
        fetch('/api/validate-cookie') // API endpoint to validate the cookie
            .then(response => {
                if (response.ok) {
                    return response.json(); // Parse the response as JSON
                } else {
                    console.error('User is not logged in.');
                    throw new Error('User not logged in');
                }
            })
            .then(userData => {
                if (userData && userData.userId) {
                    USERID = userData.userId; // Assign the userId to the global variable
                    initializeTable(); // Initialize Tabulator table after USERID is set
                } else {
                    console.error('Invalid user data received.');
                }
            })
            .catch(error => {
                console.error('Error fetching user data:', error);
            });
    
        // Function to initialize the Tabulator table
        function initializeTable() {
            new Tabulator("#reserve-table", {
                layout: "fitData",
                placeholder: "No Data Found",
                pagination: true, // Enable pagination
                paginationMode: "remote", // Enable remote pagination
                paginationSizeSelector: [40, 50, 100, 500, 1000, true],
                paginationSize: 40,
                filterMode: "remote",
                sortMode: "remote",
                ajaxParams: { userid: USERID }, // Pass USERID in AJAX parameters
                ajaxURL: "/api/fetch-booking-details",
                columns: [
                    { title: "Status", field: "reserve_status", hozAlign: "center", headerFilter: "list", headerFilterParams: { valuesLookup: true, clearable: true }, headerFilterLiveFilter: false },
                    { title: "Booking ID", field: "booking_id", headerFilter: "input", hozAlign: "center", headerFilterLiveFilter: false },
                    { title: "Reservation ID", field: "reservation_id", headerFilter: "input", hozAlign: "center", headerFilterLiveFilter: false },
                    { title: "Date", field: "date", headerFilter: "input", hozAlign: "center", headerFilterLiveFilter: false },
                    { title: "Time", field: "time", hozAlign: "center", headerFilter: "list", headerFilterParams: { valuesLookup: true, clearable: true }, headerFilterLiveFilter: false },
                    { title: "Room", field: "room", hozAlign: "center", headerFilter: "list", headerFilterParams: { valuesLookup: true, clearable: true }, headerFilterLiveFilter: false },
                    { title: "Room Setup", field: "setup", hozAlign: "center", headerFilter: "list", headerFilterParams: { valuesLookup: true, clearable: true }, headerFilterLiveFilter: false },
                    { title: "Guest", field: "guest", headerFilter: "input", hozAlign: "center", headerFilterLiveFilter: false },
                ],
                ajaxResponse: function(url, params, response) {
                    // Customize response to fit Tabulator's expected format
                    return {
                        last_page: response.last_page,
                        total: response.total_record,
                        data: response.data,
                    };
                },
            });
        }
    </script>
    
    
    
    <!-- loader -->
    <div id="loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#f4b214"/></svg></div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- <script src="js/fetch_cancel.js"></script> -->
    <script src="sneat/assets/js/ui-modals.js"></script>
    <script src="js/sec-min.js"></script>
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/jquery-migrate-3.0.0.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>

    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/magnific-popup-options.js"></script>
    <script type="module"> import { inject } from "https://cdn.jsdelivr.net/npm/@vercel/analytics/dist/index.mjs";
      inject();
    </script>
    <script src="js/main.js"></script>
  </body>

  
</html>
